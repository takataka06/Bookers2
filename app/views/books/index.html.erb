<% if @book.errors.any? %>
  <div class="alert alert-danger">
    <ul>
      <% @book.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<div class="container px-5 px-sm-0">
  <div class="row">
<div class="col-md-3">
  <h2>User info</h2>


  
  <% if current_user.profile_image.attached? %>
    <%= image_tag current_user.profile_image.variant(resize_to_limit: [100, 100]), class: "img-fluid" %>
  <% else %>
    <%= image_tag "default.jpg", class: "img-fluid" %>
  <% end %>

  <%# ユーザー情報テーブル %>
  <table class="table">
    <tbody>
      <tr>
        <th>Name</th>
        <td><%= current_user.name %></td>
      </tr>
      <tr>
        <th>Introduction</th>
        <td><%= current_user.introduction.presence || "未設定" %></td>
      </tr>
    </tbody>
  </table>

  <%# 編集ボタン（ログインユーザー本人のみ表示） %>
    <div class="row">
      <%= link_to edit_user_path(current_user), class: "btn btn-outline-secondary btn-block" do %>
        <i class="fas fa-user-cog"></i> 
      <% end %>
    </div>


  <h2 class="mt-3">New book</h2>

  <%# Book 新規作成フォーム %>
  <%= form_with model: @book, local: true do |f| %>
    <div class="form-group">
      <%= f.label :title %>
      <%= f.text_field :title, class: "form-control book_title" %>
    </div>

    <div class="form-group">
      <%= f.label :body, "Body" %>
      <%= f.text_area :body, class: "form-control book_body" %>
    </div>

    <div class="form-group">
      <%= f.submit "Create Book", class: "btn btn-success" %>
    </div>
  <% end %>
</div>
<div class="col-md-8 offset-md-1">
<h2>Books</h2>
    <table class="table table-hover table-inverse">
     <thead>
    <tr>
    <th></th>
    <th>Title</th>
    <th>Opinion</th>
    <th colspan="3"></th>
    </tr>
     </thead>
    <tbody>
  <% @books.each do |book| %>
    <tr>
      <td>
        <%= link_to user_path(book.user) do %>
          <% if book.user.profile_image.attached? %>
            <%= image_tag(book.user.profile_image, size: "80x80") %>
          <% else %>
            <%= image_tag("default.jpg", size: "80x80") %>
          <% end %>
        <% end %>
      </td>
      <td>
        <%= link_to book.title, book_path(book)  %>
      </td>
      <td>
        <%= book.body %> 
      </td>
    </tr>
  <% end %>
</tbody>
    </table>
</div>
</div>
</div>
